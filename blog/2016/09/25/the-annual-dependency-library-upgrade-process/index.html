<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-4573209-1","auto"),ga("send","pageview"))</script><meta name=robots content="noindex,nofollow"><link rel=stylesheet href=https://hiltmon.com/css/main.css><link rel=stylesheet href=https://hiltmon.com/css/all.css><link rel=stylesheet href=https://hiltmon.com/css/carbon.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>The Annual Dependency Library Upgrade Process</title></head><body><div id=container><header id=header><img id=logo src=https://hiltmon.com/images/hiltmon-logo-174.png><h1 id=title><a href=https://hiltmon.com/>Hiltmon</a></h1><h2 id=sub-title>On walkabout in life and technology</h2></header><nav id=menu><ul><li><a href=https://hiltmon.com/about/ title="about me">About</a></li><li><a href=https://hiltmon.com/code/ title=code>Code</a></li><li><a href=https://hiltmon.com/ title="blog section">Blog</a></li><li><a href=https://hiltmon.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Sep 25, 2016 2:10 PM</span></p><div class=tag-group></div><h1 class=post-title>The Annual Dependency Library Upgrade Process</h1><div class=post-body><p>At work, we write a lot of code. In order to remain productive, we reuse the same proven dependent libraries and tools over and over again. Which is fine. Until we start seeing end-of-life notices, vulnerabilities, deprecations, performance improvements and bug-fixes passing us by. At some point we need to update our dependencies for performance and security.</p><p>But its not that easy.</p><p>Take some of the libraries we use:</p><ul><li><a href=https://developers.google.com/protocol-buffers/>Google’s Protocol Buffers</a> are amazing. We’ve been on 2.6.1 for ages, but 3.1.0 is out and it supports <a href=https://swift.org/>Swift</a> and <a href=https://golang.org/>Go</a>, two languages we surely would like to use. But the <code>proto2</code> format we use everywhere is not available in the new languages. We need to migrate.</li><li><a href=http://zeromq.org/>ZeroMQ</a> moved to a secure <code>libsodium</code> base in 4.1, making it much safer to use. But the C++ bindings from 4.0.5 are incompatible. We need to migrate.</li><li><code>g++</code> on <a href=https://www.centos.org/>CentOS 6</a> is ancient, version 4.4.7 from 2010. We’ve been using the <code>devtoolset-2</code> edition 4.8.2 from 2013 to get C++11 compatibility, with a few library hacks. But that version of <code>g++</code> produces horribly slow and insecure C++11 code. We skipped <code>devtoolset-3</code> even though <code>g++</code> 4.9 was better. <code>devtoolset-4</code> is out, using <code>g++</code> 5.2.4 from 2015, still not the latest, but it is much better at C++11 (without our hacks), more secure and faster. Yet is ABI incompatible. We need to migrate.</li></ul><p>The amount of work seems staggering given we have well over 100 protobufs used across our code base, ZeroMQ everywhere and everything is compiled for production using <code>devtoolset-2</code>. The old libraries and tools are a known, proven platform. The current code is stable, reliable and fast enough. <em>It ain’t broke.</em></p><p>The benefits are also hard to measure. Given all the effort to upgrade, do we really get that much faster code, that much more secure code? And what about the code changes needed to support new interfaces, formats and ABIs? What does that get us?</p><p>For most IT shops, the discussion stops there. <strong>“It ain’t broke, don’t fix it!”</strong>, or “All pain for no gain, not gonna play.” They stay on the known tools and platforms forever.</p><p>For my IT shop, things are different. We <em>want</em> to use new tools, new languages, new platforms yet remain compatible with our existing services. We need to be secure. And we really do need to eke out each additional microsecond in computing. <strong>No, if it ain’t broke, break it!</strong></p><p>So, once in a while, generally once a year, we update the platform. Update the libraries. Update the tools. Update the databases.</p><p>And we do it right.</p><p>Firstly we try the new libraries on our development machines. <a href=https://brew.sh/>Homebrew</a> installs make that easy for the dependencies. <a href=http://rake.rubyforge.org/>Rake</a> tasks make it easy to upgrade our <a href=http://www.ruby-lang.org/en/>Ruby</a> dependencies and <a href=https://rubyonrails.org/>Rails</a> versions. We build and test our code in a migration branch and make sure it all works, changing to new interfaces and formats where necessary.</p><p>We then spin up a virtual machine on our production operating system (<a href=https://www.centos.org/>CentOS 7</a> now), install the new compiler and dependencies, and rebuild all there. Given that issues are mostly resolved in development, we only find <code>g++</code> quirks in this test.</p><p>And then one weekend, we run the scripts to update our production servers to the new tools and dependencies and deploy the new versions.</p><p>And since we do this every year, it runs like a well-oiled machine.</p><p>It helps that we have tools to recompile, run and test our entire code base. It helps that we have tools to stage and deploy all our code automatically. And it helps that we have done this before, and will do it again.</p><p>Long term, the benefits are amazing. We can try new platforms with ease. Our code gets better, faster and more secure all the time. The need for workarounds and hacks and platform specific coding becomes less and less. The ability to nimbly move our code base grows each time.</p><p>Many of the projects we want to take on become possible after the annual upgrade. That’s why we do it.</p><p><a href=https://hiltmon.com/blog/2011/12/17/hiltmonism-if-it-aint-broke/>If it ain’t broke, break it.</a></p><p>And it really is not that much work!</p><p><em>Follow the author as <a href=https://twitter.com/hiltmon>@hiltmon</a> on Twitter.</em></p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hilton Lipschitz</span>
&#183;
<span class="fas fa-clock"></span>
<span>Sep 25, 2016 2:10 PM</span></p><div class=pagination><ul><li class=post-previous><a href=https://hiltmon.com/blog/2016/10/07/the-gentleman-james-v/>&larr; The Gentleman James V</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://hiltmon.com/blog/2016/08/28/minimal-project-management-6-months-later/>Minimal Project Management - 6 Months Later &rarr;</a></li></ul></div></section><aside id=sidebar><script async type=text/javascript src="//cdn.carbonads.com/carbon.js?serve=CKYI52JE&placement=hiltmoncom" id=_carbonads_js></script><section><div id=carbonads></div>&nbsp;</section><section><h1>The Hiltmon Dot Com</h1><p><strong>Hilton Lipschitz</strong> (<a href=https://twitter.com/hiltmon>@hiltmon</a>) is CTO of an up and coming Hedge Fund, who loves to craft brilliant and delightful web, iPhone, iPad and Macintosh software products. Before this he was an independent software consultant, designer and developer at <a href=http://www.noverse.com>Noverse LLC</a>.</p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/06/07/working-from-home-88-days-later/>Working from Home ... 88 Days Later</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/03/14/working-from-home-dot-dot-dot-here-we-go/>Working from Home ... here we go!</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/12/31/the-theater-was-empty/>The Theater was Empty</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/16/an-ipad-and-a-pencil/>An iPad and a Pencil</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/09/testing-c-plus-plus-17-project-in-xcode-with-xctest/>Testing C++17 Projects in Xcode with XCTest</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/on-removing-comments/>On Removing Comments</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/stop-and-think/>Stop and Think</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/08/31/migrate-octopress-slash-jekyll-posts-to-ulysses/>Migrate Octopress / Jekyll Posts to Ulysses</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/03/12/notification-city/>Notification City</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/03/05/coding-style-standards-in-2017/>Coding Style Standards in 2017</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2022 Hilton Lipschitz</p></footer></div></body></html>