<!doctype html><html><head>
<link rel=stylesheet href=/css/main.css>
<link rel=stylesheet href=/css/all.css>
<link rel=stylesheet href=/css/fusion.css>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic" rel=stylesheet type=text/css>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<title>Attractive Multi-Line SQL Statements in C++</title>
</head>
<body>
<div id=container><header id=header>
<img id=logo src=/images/hiltmon-logo-174.png>
<h1 id=title><a href=/>Hiltmon</a></h1>
<h2 id=sub-title>On walkabout in life and technology</h2>
</header>
<nav id=menu>
<ul>
<li>
<a href=/about/ title="about me">About</a>
</li>
<li>
<a href=/code/ title=code>Code</a>
</li>
<li>
<a href=/products/ title=products>Products</a>
</li>
<li>
<a href=/ title="blog section">Blog</a>
</li>
<li>
<a href=/archives/ title="archives section">Archives</a>
</li>
</ul>
</nav>
<section id=content>
<p class=meta-data>
<span class=post-date>Apr 26, 2016 8:19 PM</span>
</p>
<h1 class=post-title>
Attractive Multi-Line SQL Statements in C++
</h1>
<div class=post-body>
<p>I often need to embed SQL statements in C++ code. Unfortunately, many of mine are long and complex. Even the simple ones are wide. This leads to the following ugly code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>std::string s8(&#34;SELECT id FROM lst_quotes WHERE route_id = $1 AND lst_request_id = $2 AND quote_id = $3;&#34;);
</code></pre></div><p>&mldr; which means I need a massively wide screen to view it (and it violates my 80-column rule), its not formatted legibly and even with wrap, its hard to understand — and this is a simple example. Its a maintenance nightmare.</p>
<p>Going multi-line, which is how SQL is usually written, makes things worse:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>std::string s8(
  &#34;SELECT id &#34;
  &#34;FROM lst_quotes &#34;
  &#34;WHERE route_id = $1 &#34;
  &#34;AND lst_request_id = $2 &#34;
  &#34;AND quote_id = $3; &#34;
);
</code></pre></div><p>C++ compilers helpfully merge the strings, but I need to put in the quotes around each line (and have a space at the end of each line before the closing quote).</p>
<p>Or this monstrosity:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>std::string s8(&#34;\
  SELECT id \
  FROM lst_quotes \
  WHERE route_id = $1 \
  AND lst_request_id = $2 \
  AND quote_id = $3; \
&#34;);
</code></pre></div><p>&mldr; where the end of line slashes <em>still</em> need to be added or the compiler gets upset.</p>
<p><strong>Ugly. Hard to maintain. Hard to read. Impossible to copy and paste. Unmaintainable.</strong></p>
<p>I want to be able to paste in SQL. Just SQL. As Is. From my database query tool.</p>
<h3 id=the-solution>The Solution</h3>
<p>The solution is a simple C++ variadic macro placed at the top of the file:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>#define SQL(...) #__VA_ARGS__
</code></pre></div><p>When used, this macro concatenates all lines between the parentheses, gets rid of newlines and, as an additional bonus, converts multiple white spaces into single ones. So this code (note the sexy formatting and excellent use of white space):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>  std::string s8( SQL(
  
    SELECT id
    FROM lst_quotes
    WHERE route_id = $1
    AND lst_request_id = $2
    AND quote_id = $3;
    
  ));
</code></pre></div><p>Looks and works great. I can format, make legible and paste SQL in as necessary — the way SQL was meant to be.</p>
<p>When compiled, the resulting string is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback>SELECT id FROM lst_quotes WHERE route_id = $1 AND lst_request_id = $2 AND quote_id = $3;
</code></pre></div><p>&mldr; which is the desired compact version to pass on to the server.</p>
<p><strong>Legible. Easy to maintain. Easy to read. Simple to copy and paste. Very maintainable.</strong></p>
<p><em>Follow the author as <a href=https://twitter.com/hiltmon>@hiltmon</a> on Twitter.</em></p>
</div>
<p class=post-mark>
<span class="fas fa-envelope"></span>
<span>Posted By Hilton Lipschitz</span>
&#183;
<span class="fas fa-clock"></span>
<span>Apr 26, 2016 8:19 PM</span>
</p>
<div class=pagination>
<ul>
<li class=post-previous><a href=https://hiltmon.github.io/blog/2016/08/28/minimal-project-management-6-months-later/>&larr; Minimal Project Management - 6 Months Later</a></li>
<li class=post-center>&nbsp;</li>
<li class=post-next><a href=https://hiltmon.github.io/blog/2016/04/24/apple-watch-after-1-year/>Apple Watch - After 1 Year &rarr;</a></li>
</ul>
</div>
</section><aside id=sidebar>
<section>
<h1>The Hiltmon Dot Com</h1>
<p><strong>Hilton Lipschitz</strong> (<a href=https://twitter.com/hiltmon>@hiltmon</a>) is CTO of an up and coming Hedge Fund, who loves to craft brilliant and delightful web, iPhone, iPad and Macintosh software products. Before this he was an independent software consultant, designer and developer at <a href=http://www.noverse.com>Noverse LLC</a>.</p>
</section><section>
<h1>Recent Posts</h1>
<ul>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2020/06/07/working-from-home-88-days-later/>Working from Home ... 88 Days Later</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2020/03/14/working-from-home-dot-dot-dot-here-we-go/>Working from Home ... here we go!</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2019/12/31/the-theater-was-empty/>The Theater was Empty</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2019/02/16/an-ipad-and-a-pencil/>An iPad and a Pencil</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2019/02/09/testing-c-plus-plus-17-project-in-xcode-with-xctest/>Testing C++17 Projects in Xcode with XCTest</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2018/06/17/on-removing-comments/>On Removing Comments</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2018/06/17/stop-and-think/>Stop and Think</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2017/08/31/migrate-octopress-slash-jekyll-posts-to-ulysses/>Migrate Octopress / Jekyll Posts to Ulysses</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2017/03/12/notification-city/>Notification City</a></li>
<li><a class=sidebar-link href=https://hiltmon.github.io/blog/2017/03/05/coding-style-standards-in-2017/>Coding Style Standards in 2017</a></li>
</ul>
<section></aside><footer id=footer>
<p>Copyright &copy; 2022 Hilton Lipschitz</p>
</footer></div>
</body>
</html>