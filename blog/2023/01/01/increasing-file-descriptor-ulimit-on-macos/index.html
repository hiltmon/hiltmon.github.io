<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFJ7SZKLR0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZFJ7SZKLR0",{anonymize_ip:!1})}</script><meta name=robots content="index,follow"><link rel=stylesheet href=https://hiltmon.com/css/main.css><link rel=stylesheet href=https://hiltmon.com/css/all.css><link rel=stylesheet href=https://hiltmon.com/css/carbon.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>Increasing File Descriptor Ulimit on MacOS</title></head><body><div id=container><header id=header><img id=logo src=https://hiltmon.com/images/hiltmon-logo-174.png><h1 id=title><a href=https://hiltmon.com/>Hiltmon</a></h1><h2 id=sub-title>On walkabout in life and technology</h2></header><nav id=menu><ul><li><a href=https://hiltmon.com/about/ title="about me">About</a></li><li><a href=https://hiltmon.com/ title="blog section">Blog</a></li><li><a href=https://hiltmon.com/code/ title=code>Code</a></li><li><a href=https://hiltmon.com/tags/ title="tags section">Tags</a></li><li><a href=https://hiltmon.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Jan 1, 2023 11:17 AM</span></p><div class=tag-group><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/development>Development</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/macintosh>Macintosh</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/tips-and-tricks>Tips and Tricks</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/os-x>OS X</a></span></div></div><h1 class=post-title>Increasing File Descriptor Ulimit on MacOS</h1><div class=post-body><blockquote><p><strong>Warning:</strong> This post is only for developers who are having issues when coding against <code>file descriptors</code> in the form of C-style file handles or sockets on MacOS. For everyone else, this does not apply.</p></blockquote><h3 id=running-out-of-resources>Running out of Resources</h3><p>Right now I am developing an application that uses sockets (underneath a stack of other software) for inter-process communication. The problem is that after a few debug runs or crashes (I did say developing), the application will not start again from resource starvation. And the error message is no help at all.</p><p>Creating a socket connection internally asks for and uses up a system file descriptor. If the socket is closed properly, that file descriptor is returned back to the system. But when developing or debugging, because of crashes or hard kills, the socket may still close but the file descriptor is not released back. If the number of file descriptors for a process are exceeded, no new ones can be created. And no new runs can happen. It happens to me several times a day, and the only solution is to reboot.</p><p>On MacOS, the maximum number of file descriptors is set to a quite low 256. To see yours, run <code>ulimit -n</code>. <em>Once again I must remind you, this is plenty for 99.9% of all use cases on a Mac and should not be changed!</em></p><h3 id=increasing-file-descriptors>Increasing file descriptors</h3><p>In order to permanently change the file descriptor limit, you need to run a script at boot to setup the system limits you prefer. This has been tested on MacOS Ventura, Monterey and Big Sur.</p><p>In <code>/Library/LaunchDaemons</code>, create a file called <code>limit.maxfiles.plist</code> and fill it with this:</p><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;!DOCTYPE plist PUBLIC &#34;-//Apple/DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
  &lt;plist version=&#34;1.0&#34;&gt;
    &lt;dict&gt;
      &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;limit.maxfiles&lt;/string&gt;
      &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
          &lt;string&gt;launchctl&lt;/string&gt;
          &lt;string&gt;limit&lt;/string&gt;
          &lt;string&gt;maxfiles&lt;/string&gt;
          &lt;string&gt;8192&lt;/string&gt;
          &lt;string&gt;81920&lt;/string&gt;
        &lt;/array&gt;
      &lt;key&gt;RunAtLoad&lt;/key&gt;
        &lt;true /&gt;
      &lt;key&gt;ServiceIPC&lt;/key&gt;
        &lt;false /&gt;
    &lt;/dict&gt;
  &lt;/plist&gt;
</code></pre><p>This increases open files (soft) from 256 to 8192, and system-wide (hard) from 8192 to 81920.</p><p>To ensure this runs successfully, run the following commands to set ownership, permissions and add it to the boot flow:</p><pre tabindex=0><code>sudo chown root:wheel limit.maxfiles.plist
sudo chmod 0644 limit.maxfiles.plist
sudo launchctl load -w /Library/LaunchDaemons/limit.maxfiles.plist
</code></pre><p>Then reboot your Mac. After a restart, you should see the new numbers:</p><pre tabindex=0><code>~ ❯ ulimit -Sn
8192
~ ❯ ulimit -Hn
81920
</code></pre><p>And you are good to go.</p><h3 id=yes-i-tried>Yes, I tried</h3><ul><li>The Linux solution:</li></ul><pre tabindex=0><code>echo &#34;* hard nofile 81920&#34; &gt;&gt; /etc/security/limits.conf
echo &#34;* soft nofile 8192&#34; &gt;&gt; /etc/security/limits.conf
sysctl -w fs.file-max=8192
sysctl -p
</code></pre><ul><li>Editing <code>/etc/systctl.conf</code> manually</li><li>Adding <code>ulimit -n 8192</code> to the shell startup</li></ul><p>They work on Linux (and you should use those there) but not on MacOs.</p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hilton Lipschitz</span>
&#183;
<span class="fas fa-clock"></span>
<span>Jan 1, 2023 11:17 AM</span></p><div class=pagination><ul><li class=post-previous><a href=https://hiltmon.com/blog/2023/02/11/zero-to-one-stages-of-startup-development/>&larr; Zero to One: Stages of Startup Development</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://hiltmon.com/blog/2022/12/21/who-dares-wins/>Who Dares, Wins &rarr;</a></li></ul></div></section><aside id=sidebar><script async type=text/javascript src="//cdn.carbonads.com/carbon.js?serve=CKYI52JE&placement=hiltmoncom" id=_carbonads_js></script><section><div id=carbonads></div>&nbsp;</section><section><h1>The Hiltmon Dot Com</h1><p><strong>Hilton Lipschitz</strong> (<a href=https://twitter.com/hiltmon>@hiltmon</a>) an independent software consultant, architect, designer and developer at <a href=https://noverse.com>Noverse LLC</a> (his own small business).</p><p>For the past 23 years he has specialized in the architecture, design, development, operations and trading of bespoke comprehensive front-to-back, multi-asset, <em>automated and algorithmic</em> trading, portfolio management and asset management systems to enable and grow three asset managers.</p><p><a href=https://mastodon.social/@hiltmon rel=me>Mastodon</a> &#183;
<a href=https://twitter.com/hiltmon>Twitter</a> &#183;
<a href=https://github.com/hiltmon>Github</a> &#183;
<a href=https://www.linkedin.com/in/hiltmon/>LinkedIn</a> &#183;
<a href=https://hiltmon.com/index.xml>RSS</a></p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://hiltmon.com/blog/2023/02/11/zero-to-one-stages-of-startup-development/>Zero to One: Stages of Startup Development</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2023/01/01/increasing-file-descriptor-ulimit-on-macos/>Increasing File Descriptor Ulimit on MacOS</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/12/21/who-dares-wins/>Who Dares, Wins</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/11/03/update-hugo-for-node-16-github-pages/>Update Hugo for Node 16 Github Pages</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/11/03/two-months-with-the-m1-macbook-pro/>Two Months with the M1 Macbook Pro</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/10/26/where-the-rights-are/>Where the Rights Are</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/10/20/innocuous-birthday-career-advice/>Innocuous Birthday Career Advice</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/10/12/go-to-where-the-puck-is-going/>Go to Where the Puck Is Going</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/10/04/hiltmonism-discoverability-is-deserved/>Discoverability Is Deserved</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/09/13/what-did-i-create-as-an-asset-manager-cto/>What Did I Create as an Asset Manager CTO</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2023 Hilton Lipschitz</p></footer></div></body></html>