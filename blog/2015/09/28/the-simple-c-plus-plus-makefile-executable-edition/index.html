<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFJ7SZKLR0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZFJ7SZKLR0",{anonymize_ip:!1})}</script><meta name=robots content="index,follow"><link rel=stylesheet href=https://hiltmon.com/css/main.css><link rel=stylesheet href=https://hiltmon.com/css/all.css><link rel=stylesheet href=https://hiltmon.com/css/carbon.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>The Simple C++ Makefile - Executable Edition</title></head><body><div id=container><header id=header><img id=logo src=https://hiltmon.com/images/hiltmon-logo-174.png><h1 id=title><a href=https://hiltmon.com/>Hiltmon</a></h1><h2 id=sub-title>On walkabout in life and technology</h2></header><nav id=menu><ul><li><a href=https://hiltmon.com/about/ title="about me">About</a></li><li><a href=https://hiltmon.com/code/ title=code>Code</a></li><li><a href=https://hiltmon.com/ title="blog section">Blog</a></li><li><a href=https://hiltmon.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Sep 28, 2015 10:07 PM</span></p><div class=tag-group><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/c++>C++</a></span></div></div><h1 class=post-title>The Simple C++ Makefile - Executable Edition</h1><div class=post-body><p>I develop a lot of applications in C++ using Xcode on OS X and deploy them to CentOS Linux Servers to run. I follow the <a href=https://hiltmon.com/blog/2013/07/03/a-simple-c-plus-plus-project-structure/>Simple C++ Project Structure</a> (and the <a href=https://hiltmon.com/blog/2015/08/01/simple-c-plus-plus-from-makefiles-to-xcode-builds/>Xcode edition</a>) to code up each product.</p><p>However, Xcode is not available on Linux. To compile and deploy (and to test compiles and deploys), I use standard Unix <a href=https://www.gnu.org/software/make/manual/make.html#Introduction>Makefiles</a>, available almost everywhere.</p><p>In this post I will show you the Makefile I use for multi-platform C++ <em>executable</em> builds and explain what each line and command does in detail. <span class=light>For Library builds, I have a similar, but different Makefile, see The Simple C++ Makefile - Library Edition (Coming Soon).</span></p><h2 id=the-standard-project>The Standard Project</h2><p>I have selected one of my real projects for this post. The project is laid out as follows <span class=light>(most of the source files have been removed to shorten the list)</span>:</p><pre tabindex=0><code>.
├── Makefile
├── README.markdown
├── SantaCruzServer.xcodeproj
├── doc
│   └── SantaCruz-dev.yml
├── include
│   ├── caches
│   │   └── session_cache.h
│   ├── components
│   ├── connections
│   ├── queues
│   ├── workers
│   └── version.h
└── src
    ├── caches
    │   └── session_cache.cpp
    ├── components
    ├── connections
    ├── workers
  	└── main.cpp
</code></pre><p>As expected, the C++ source files are under the <code>src</code> folder and includes are in the <code>include</code> tree.</p><p>And here is the Makefile, the actual one I am using. Scroll below to see the breakdown and why I did it this way.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-make data-lang=make><span style=display:flex><span><span style=color:#177500>#
</span></span></span><span style=display:flex><span><span style=color:#177500>#  Makefile
</span></span></span><span style=display:flex><span><span style=color:#177500>#  SantaCruzServer
</span></span></span><span style=display:flex><span><span style=color:#177500>#
</span></span></span><span style=display:flex><span><span style=color:#177500>#  Created by Hilton Lipschitz on 2015-09-01.
</span></span></span><span style=display:flex><span><span style=color:#177500>#  Copyright (c) 2015 Maritime Capital LP. All rights reserved.
</span></span></span><span style=display:flex><span><span style=color:#177500>#
</span></span></span><span style=display:flex><span><span style=color:#177500></span>
</span></span><span style=display:flex><span><span style=color:#177500># HIL: No spaces or comments after otherwise it captures them!
</span></span></span><span style=display:flex><span><span style=color:#177500># Determine the platform
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>UNAME_S</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>shell uname -s<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># CC
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>ifeq</span> <span style=color:#000>(</span><span style=color:#a90d91>$(</span><span style=color:#000>UNAME_S</span><span style=color:#a90d91>)</span><span style=color:#000>,Darwin)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>CC</span> <span style=color:#000>:=</span> clang++ -arch x86_64
</span></span><span style=display:flex><span><span style=color:#000>else</span>
</span></span><span style=display:flex><span>	<span style=color:#000>CC</span> <span style=color:#000>:=</span> g++
</span></span><span style=display:flex><span><span style=color:#000>endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Folders
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>SRCDIR</span> <span style=color:#000>:=</span> src
</span></span><span style=display:flex><span><span style=color:#000>BUILDDIR</span> <span style=color:#000>:=</span> build
</span></span><span style=display:flex><span><span style=color:#000>TARGETDIR</span> <span style=color:#000>:=</span> bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Targets
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>EXECUTABLE</span> <span style=color:#000>:=</span> SantaCruzServer
</span></span><span style=display:flex><span><span style=color:#000>TARGET</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>TARGETDIR<span style=color:#a90d91>)</span>/<span style=color:#a90d91>$(</span>EXECUTABLE<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Final Paths
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>INSTALLBINDIR</span> <span style=color:#000>:=</span> /usr/local/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Code Lists
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>SRCEXT</span> <span style=color:#000>:=</span> cpp
</span></span><span style=display:flex><span><span style=color:#000>SOURCES</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>shell find <span style=color:#a90d91>$(</span>SRCDIR<span style=color:#a90d91>)</span> -type f -name *.<span style=color:#a90d91>$(</span>SRCEXT<span style=color:#a90d91>))</span>
</span></span><span style=display:flex><span><span style=color:#000>OBJECTS</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>patsubst <span style=color:#a90d91>$(</span>SRCDIR<span style=color:#a90d91>)</span>/%,<span style=color:#a90d91>$(</span>BUILDDIR<span style=color:#a90d91>)</span>/%,<span style=color:#a90d91>$(</span>SOURCES:.<span style=color:#a90d91>$(</span>SRCEXT<span style=color:#a90d91>)</span><span style=color:#000>=</span>.o<span style=color:#a90d91>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Folder Lists
</span></span></span><span style=display:flex><span><span style=color:#177500># Note: Intentionally excludes the root of the include folder so the lists are clean
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>INCDIRS</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>shell find include/**/* -name <span style=color:#c41a16>&#39;*.h&#39;</span> -exec dirname <span style=color:#000>{}</span> <span style=color:#c41a16>\;</span> | sort | uniq<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span><span style=color:#000>INCLIST</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>patsubst include/%,-I include/%,<span style=color:#a90d91>$(</span>INCDIRS<span style=color:#a90d91>))</span>
</span></span><span style=display:flex><span><span style=color:#000>BUILDLIST</span> <span style=color:#000>:=</span> <span style=color:#a90d91>$(</span>patsubst include/%,<span style=color:#a90d91>$(</span>BUILDDIR<span style=color:#a90d91>)</span>/%,<span style=color:#a90d91>$(</span>INCDIRS<span style=color:#a90d91>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Shared Compiler Flags
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>CFLAGS</span> <span style=color:#000>:=</span> -c
</span></span><span style=display:flex><span><span style=color:#000>INC</span> <span style=color:#000>:=</span> -I include <span style=color:#a90d91>$(</span>INCLIST<span style=color:#a90d91>)</span> -I /usr/local/include
</span></span><span style=display:flex><span><span style=color:#000>LIB</span> <span style=color:#000>:=</span> -L /usr/local/lib -lsantacruzengine -lsantacruzlib -larcadia -lcorinth -lyaml-cpp -lzmq -lhiredis -lbondoas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#177500># Platform Specific Compiler Flags
</span></span></span><span style=display:flex><span><span style=color:#177500></span><span style=color:#000>ifeq</span> <span style=color:#000>(</span><span style=color:#a90d91>$(</span><span style=color:#000>UNAME_S</span><span style=color:#a90d91>)</span><span style=color:#000>,Linux)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>CFLAGS</span> <span style=color:#000>+=</span> -std<span style=color:#000>=</span>gnu++11 -O2 <span style=color:#177500># -fPIC</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#177500># PostgreSQL Special</span>
</span></span><span style=display:flex><span>    PG_VER :<span style=color:#000>=</span> 9.3
</span></span><span style=display:flex><span>    <span style=color:#000>INC</span> <span style=color:#000>+=</span> -I /usr/pgsql-<span style=color:#a90d91>$(</span>PG_VER<span style=color:#a90d91>)</span>/include
</span></span><span style=display:flex><span>    <span style=color:#000>LIB</span> <span style=color:#000>+=</span> -L /usr/pgsql-<span style=color:#a90d91>$(</span>PG_VER<span style=color:#a90d91>)</span>/lib 
</span></span><span style=display:flex><span><span style=color:#000>else</span>
</span></span><span style=display:flex><span>	<span style=color:#000>CFLAGS</span> <span style=color:#000>+=</span> -std<span style=color:#000>=</span>c++11 -stdlib<span style=color:#000>=</span>libc++ -O2
</span></span><span style=display:flex><span><span style=color:#000>endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>$(TARGET)</span><span style=color:#000>:</span> <span style=color:#a90d91>$(</span><span style=color:#000>OBJECTS</span><span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>	@mkdir -p <span style=color:#a90d91>$(</span>TARGETDIR<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;Linking...&#34;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;  Linking </span><span style=color:#a90d91>$(</span>TARGET<span style=color:#a90d91>)</span><span style=color:#c41a16>&#34;</span>; <span style=color:#a90d91>$(</span>CC<span style=color:#a90d91>)</span> $^ -o <span style=color:#a90d91>$(</span>TARGET<span style=color:#a90d91>)</span> <span style=color:#a90d91>$(</span>LIB<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>$(BUILDDIR)/%.o</span><span style=color:#000>:</span> <span style=color:#a90d91>$(</span><span style=color:#000>SRCDIR</span><span style=color:#a90d91>)</span>/%.<span style=color:#a90d91>$(</span><span style=color:#000>SRCEXT</span><span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>	@mkdir -p <span style=color:#a90d91>$(</span>BUILDLIST<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;Compiling </span>$<span style=color:#c41a16>&lt;...&#34;</span>; <span style=color:#a90d91>$(</span>CC<span style=color:#a90d91>)</span> <span style=color:#a90d91>$(</span>CFLAGS<span style=color:#a90d91>)</span> <span style=color:#a90d91>$(</span>INC<span style=color:#a90d91>)</span> -c -o <span style=color:#000>$@</span> $&lt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>clean</span><span style=color:#000>:</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;Cleaning </span><span style=color:#a90d91>$(</span>TARGET<span style=color:#a90d91>)</span><span style=color:#c41a16>...&#34;</span>; <span style=color:#a90d91>$(</span>RM<span style=color:#a90d91>)</span> -r <span style=color:#a90d91>$(</span>BUILDDIR<span style=color:#a90d91>)</span> <span style=color:#a90d91>$(</span>TARGET<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>install</span><span style=color:#000>:</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;Installing </span><span style=color:#a90d91>$(</span>EXECUTABLE<span style=color:#a90d91>)</span><span style=color:#c41a16>...&#34;</span>; cp <span style=color:#a90d91>$(</span>TARGET<span style=color:#a90d91>)</span> <span style=color:#a90d91>$(</span>INSTALLBINDIR<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#000>distclean</span><span style=color:#000>:</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#c41a16>&#34;Removing </span><span style=color:#a90d91>$(</span>EXECUTABLE<span style=color:#a90d91>)</span><span style=color:#c41a16>&#34;</span>; rm <span style=color:#a90d91>$(</span>INSTALLBINDIR<span style=color:#a90d91>)</span>/<span style=color:#a90d91>$(</span>EXECUTABLE<span style=color:#a90d91>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>.PHONY</span><span style=color:#000>:</span> <span style=color:#000>clean</span>
</span></span></code></pre></div><br><h2 id=breaking-the-makefile-down>Breaking the Makefile down</h2><p>This Makefile compiles a program called <code>SantaCruzServer</code> into the local <code>bin</code> folder, and installs it into the standard shared OS X and Linux <code>/usr/local/bin</code> folder. Lets see how it does it, line by line.</p><pre tabindex=0><code>UNAME_S := $(shell uname -s)
</code></pre><p>The first step is to determine which platform the <code>make</code> is running on. I look for <code>Darwin</code> indicating an OS X computer or <code>Linux</code> for Linux.</p><pre tabindex=0><code># CC
ifeq ($(UNAME_S),Darwin)
	CC := clang++ -arch x86_64
else
	CC := g++
endif
</code></pre><p>OS X uses the new LLVM Clang compiler (I choose the C++ version), but my Linux servers run GCC 4.8. The <code>$(CC)</code> variable now contains the compiler command for the current platform.</p><pre tabindex=0><code># Folders
SRCDIR := src
BUILDDIR := build
TARGETDIR := bin
</code></pre><p>These variables set the location of the Source Code (<code>src</code>), where the build object files will go (<code>build</code>) and where the target will be saved (<code>bin</code>).</p><pre tabindex=0><code># Targets
EXECUTABLE := SantaCruzServer
TARGET := $(TARGETDIR)/$(EXECUTABLE)
</code></pre><p>This sets up the Makefile target to make <code>bin/SantaCruzServer</code>. Note that, by default, this Makefile builds to a local <code>bin</code> folder so it does not overwrite the running application in case of a failed compile on deploy.</p><pre tabindex=0><code># Final Paths
INSTALLBINDIR := /usr/local/bin
</code></pre><p>This sets where the executable will be installed.</p><pre tabindex=0><code># Code Lists
SRCEXT := cpp
SOURCES := $(shell find $(SRCDIR) -type f -name *.$(SRCEXT))
OBJECTS := $(patsubst $(SRCDIR)/%,$(BUILDDIR)/%,$(SOURCES:.$(SRCEXT)=.o))
</code></pre><p><code>Make</code> needs a list of source code files to compile to object files. This list gets built here. I use the <code>$(SRCEXT)</code> variable to store my source code file extension. I then use a shell command to search the <code>src</code> folder (and its subfolders) for all <code>.cpp</code> files and build the <code>$(SOURCES)</code> list. I then create an <code>$(OBJECTS)</code> list from the <code>$(SOURCES)</code> substituting the source path and extension with the build path and the object extension. This makes our compile rule simpler.</p><pre tabindex=0><code># Folder Lists
# Note: Intentionally excludes the root of the include folder so the lists are clean
INCDIRS := $(shell find include/**/* -name &#39;*.h&#39; -exec dirname {} \; | sort | uniq)
INCLIST := $(patsubst include/%,-I include/%,$(INCDIRS))
BUILDLIST := $(patsubst include/%,$(BUILDDIR)/%,$(INCDIRS))
</code></pre><p>The next set of lists are used to build the list of include folders and related lists.</p><p><span class=light>Aside: I am one of those quirky C++ programmers that does not use pathed <code>#includes</code> (e.g. Instead of <code>#include "../caches/session_cache.h"</code> I simply use <code>#include "session_cache.h"</code>) and expect the compiler to figure it where things are. This way I can re-arrange the code-base by moving files around, not change anything and it still compiles and runs. Xcode behaves the same way by default.</span></p><p>So, the <code>$(INCDIRS)</code> variable contains a unique list of subfolders under the <code>include</code> folder where all my header files reside. The <code>$(INCLIST)</code> variable is a transformation of <code>$(INCDIRS)</code> into the format needed as compiler flags. For example <code>include/caches</code> is transformed into <code>-I include/caches</code>. The <code>$(BUILDLIST)</code> variable creates a list of pathed subfolders for the <code>build</code> folder, where <code>include/caches</code> becomes <code>build/caches</code> for the compile step.</p><pre tabindex=0><code># Shared Compiler Flags
CFLAGS := -c
INC := -I include $(INCLIST) -I /usr/local/include
LIB := -L /usr/local/lib -lsantacruzengine -lsantacruzlib -larcadia -lcorinth -lyaml-cpp -lzmq -lhiredis -lbondoas
</code></pre><p>Most of the compiler flags are shared across both platforms and are set here. In this case, <code>$(CFLAGS)</code> is set to tell the compiler to compile only.</p><p>The <code>$(INC)</code> variable is set to help the compiler find include files automatically, so it adds the <code>include</code> folder where the root header files are, the list of include subfolders determined above and the system shared <code>/usr/local/include</code> folder for shared library includes. Now I no longer need to worry when I move files around the code-base.</p><p>The <code>$(LIB)</code> variable adds the shared system <code>/usr/local/lib</code> folder where the shared libraries can be found. The rest of that line contains a long list of libraries that this real program needs to link with (<em>and is project specific - you need to set these for each project based on that project&rsquo;s needs</em>). Note that all my shared libraries are in <code>/usr/local</code>.</p><pre tabindex=0><code># Platform Specific Compiler Flags
ifeq ($(UNAME_S),Linux)
  	CFLAGS += -std=gnu++11 -O2 # -fPIC
  
  	# PostgreSQL Special
  	PG_VER := 9.3
  	INC += -I /usr/pgsql-$(PG_VER)/include
  	LIB += -L /usr/pgsql-$(PG_VER)/lib 
else
	CFLAGS += -std=c++11 -stdlib=libc++ -O2
endif
</code></pre><p>Not all settings are the same, which is why the Makefile now adds platform-specific parameters to our variables.</p><p>On Linux, I use the <code>gnu++11</code> system library (to go with <code>g++</code>) and this gets added to the <code>$(CFLAGS)</code> variable. Also, for some unknowable reason, the PostgreSQL include and library files are in a non-standard location in Linux, so they get added to the <code>$(INC)</code> and <code>$(LIB)</code> variables too.</p><p>On OS X, I set <code>clang</code> to use the <code>c++11</code> language and to link with the <code>libc++</code> system library.</p><pre tabindex=0><code>$(TARGET): $(OBJECTS)
	@mkdir -p $(TARGETDIR)
	@echo &#34;Linking...&#34;
	@echo &#34;  Linking $(TARGET)&#34;; $(CC) $^ -o $(TARGET) $(LIB)
</code></pre><p>As a habit, I set the final goal of the Makefile first. In this case, <code>make</code> needs to make the <code>$(TARGET)</code> which is <code>bin/SantaCruzServer</code> given the list of <code>$(OBJECTS)</code> we generated above.</p><p>First it creates the <code>bin</code> folder if it does not exist, then links the objects into an executable. The <code>$^</code> represents the list of targets.</p><p><span class=light>Aside: I am also not one of those people who has to see a busy screen of detailed commands as they compile. So, for Makefile rules, I prepend them with a friendly message and do not print out the actual multi-line incomprehensible command. See the output later on for examples.</span></p><pre tabindex=0><code>$(BUILDDIR)/%.o: $(SRCDIR)/%.$(SRCEXT)
	@mkdir -p $(BUILDLIST)
	@echo &#34;Compiling $&lt;...&#34;; $(CC) $(CFLAGS) $(INC) -c -o $@ $&lt;
</code></pre><p>The Makefile needs to know how to generate the <code>$(OBJECTS)</code>, and that&rsquo;s where the compile step comes in. For all files in the <code>src</code> folder, it compiles to a matching object file in the <code>build</code> folder.</p><p>That&rsquo;s all we need to build the application, but the Makefile has to do more.</p><pre tabindex=0><code>clean:
	@echo &#34;Cleaning $(TARGET)...&#34;; $(RM) -r $(BUILDDIR) $(TARGET)
</code></pre><p>The <code>clean</code> target tells <code>make</code> to remove the target <code>bin/SantaCruzServer</code> and the <code>build</code> folder. This gives us the ability to force a full recompile.</p><pre tabindex=0><code>install:
	@echo &#34;Installing $(EXECUTABLE)...&#34;; cp $(TARGET) $(INSTALLBINDIR)
</code></pre><p>The <code>install</code> target copies <code>SantaCruzServer</code> to <code>/usr/local/bin</code> where it will run in production.</p><pre tabindex=0><code>distclean:
	@echo &#34;Removing $(EXECUTABLE)&#34;; rm $(INSTALLBINDIR)/$(EXECUTABLE)
</code></pre><p>And to uninstall, we have the <code>distclean</code> target.</p><pre tabindex=0><code>.PHONY: clean
</code></pre><p>This final line of code tricks <code>make</code> into being able to run the <code>clean</code> rules. If it were not here, <code>make</code> would try to build a file called <code>clean</code> and fail.</p><h2 id=using-the-makefile>Using the Makefile</h2><p>To start</p><pre tabindex=0><code>$ make clean
</code></pre><p>This resets the environment. The output in this project is:</p><pre tabindex=0><code>Cleaning bin/SantaCruzServer...
</code></pre><p>To build the executable</p><pre tabindex=0><code>$ make -j
</code></pre><p>This tells <code>make</code> to build the primary target - in this case the first and only one in the file.</p><p><span class=light>Tip: The <code>-j</code> parameter parallelizes the build for speed. The documentation for <code>make</code> specifies that you need a number of jobs as part of this parameter, but if you set none, <code>make</code> uses all cores.</span></p><p>In my case, the output is:</p><pre tabindex=0><code>Compiling src/connections/control_channel_responder.cpp...
Compiling src/connections/request_listener.cpp...
Compiling src/connections/response_publisher.cpp...
Compiling src/caches/session_cache.cpp...
Compiling src/main.cpp...
Compiling src/sc_configuration.cpp...
Compiling src/sc_logger.cpp...
Compiling src/sc_server.cpp...
Compiling src/workers/worker.cpp...
Compiling src/workers/worker_pool.cpp...
Linking...
  Linking bin/SantaCruzServer
</code></pre><p>The executable can now be found in <code>bin/SantaCruzServer</code> and run.</p><pre tabindex=0><code>$ bin/SantaCruzServer
2015-09-28 21:50:53.999 Info: SantaCruz V0.01 Alpha Server Starting...
2015-09-28 21:50:53.006 Debug: Using SantaCruzLIB Version 0.1 Alpha
2015-09-28 21:50:53.013 Debug: Using SantaCruzEngine Version 0.1 Alpha
</code></pre><p>To install the executable in production:</p><pre tabindex=0><code>sudo make install
</code></pre><p>This will copy the new executable into production. <span class=light>For development deploys, you do not need the <code>sudo</code>.</span></p><p>The output is:</p><pre tabindex=0><code>Installing SantaCruzServer...
</code></pre><p>And to uninstall:</p><pre tabindex=0><code>$ make distclean
Removing SantaCruzServer
</code></pre><p>And the executable is all gone.</p><h2 id=reusing-this-makefile-in-the-next-project>Reusing this Makefile in the next project</h2><p>The entire Makefile can be copied to the next project. Only a few changes are needed:</p><ul><li>The <code>$(EXECUTABLE)</code> name needs to change for the new project</li><li>The list of libraries in the <code>$(LIB)</code> variable needs to match the libraries linked to by the new project.</li><li>If PostgreSQL is not needed, remove it from the Linux Platform Specific Compiler Flags (and remove the <code>$(INC)</code> and <code>$(LIB)</code> additions).</li></ul><p>And that&rsquo;s all there is to it.</p><p>I am using this same Makefile pattern across many, many projects and it works well for me. I hope it can help you compile and deploy your C++ projects with ease.</p><p><em>Follow the author as <a href=https://twitter.com/hiltmon>@hiltmon</a> on Twitter.</em></p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hilton Lipschitz</span>
&#183;
<span class="fas fa-clock"></span>
<span>Sep 28, 2015 10:07 PM</span></p><div class=pagination><ul><li class=post-previous><a href=https://hiltmon.com/blog/2015/10/04/why-i-am-subscribing-to-apple-music/>&larr; Why I Subscribed to Apple Music</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://hiltmon.com/blog/2015/09/20/saturday-afternoons-watching-rugby-union/>Saturday Afternoons Watching Rugby Union &rarr;</a></li></ul></div></section><aside id=sidebar><script async type=text/javascript src="//cdn.carbonads.com/carbon.js?serve=CKYI52JE&placement=hiltmoncom" id=_carbonads_js></script><section><div id=carbonads></div>&nbsp;</section><section><h1>The Hiltmon Dot Com</h1><p><strong>Hilton Lipschitz</strong> (<a href=https://twitter.com/hiltmon>@hiltmon</a>) is CTO of an up and coming Hedge Fund, who loves to craft brilliant and delightful web, iPhone, iPad and Macintosh software products. Before this he was an independent software consultant, designer and developer at <a href=https://noverse.com>Noverse LLC</a>.</p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/06/07/working-from-home-88-days-later/>Working from Home ... 88 Days Later</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/03/14/working-from-home-dot-dot-dot-here-we-go/>Working from Home ... here we go!</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/12/31/the-theater-was-empty/>The Theater was Empty</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/16/an-ipad-and-a-pencil/>An iPad and a Pencil</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/09/testing-c-plus-plus-17-project-in-xcode-with-xctest/>Testing C++17 Projects in Xcode with XCTest</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/on-removing-comments/>On Removing Comments</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/stop-and-think/>Stop and Think</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/08/31/migrate-octopress-slash-jekyll-posts-to-ulysses/>Migrate Octopress / Jekyll Posts to Ulysses</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/03/12/notification-city/>Notification City</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/03/05/coding-style-standards-in-2017/>Coding Style Standards in 2017</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2022 Hilton Lipschitz</p></footer></div></body></html>