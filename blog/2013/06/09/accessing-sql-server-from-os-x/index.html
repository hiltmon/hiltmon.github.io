<!doctype html><html><head><meta charset=utf-8><meta name=keywords content><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFJ7SZKLR0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZFJ7SZKLR0",{anonymize_ip:!1})}</script><meta name=robots content="index,follow"><link rel=stylesheet href=https://hiltmon.com/css/main.css><link rel=stylesheet href=https://hiltmon.com/css/all.css><link rel=stylesheet href=https://hiltmon.com/css/carbon.css><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic' rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script><title>Accessing SQL Server from OS X</title></head><body><div id=container><header id=header><img id=logo src=https://hiltmon.com/images/hiltmon-logo-174.png><h1 id=title><a href=https://hiltmon.com/>Hiltmon</a></h1><h2 id=sub-title>On walkabout in life and technology</h2></header><nav id=menu><ul><li><a href=https://hiltmon.com/about/ title="about me">About</a></li><li><a href=https://hiltmon.com/code/ title=code>Code</a></li><li><a href=https://hiltmon.com/ title="blog section">Blog</a></li><li><a href=https://hiltmon.com/archives/ title="archives section">Archives</a></li></ul></nav><section id=content><p class=meta-data><span class=post-date>Jun 9, 2013 10:56 AM</span></p><div class=tag-group><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/scripting>Scripting</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/python>python</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/ruby>ruby</a></span></div><div class=tag><span class=tag-text>| <a href=https://hiltmon.com/tags/microsoft>microsoft</a></span></div></div><h1 class=post-title>Accessing SQL Server from OS X</h1><div class=post-body><p>Every once in a while I need to access a Microsoft SQL Server database from my Mac, usually to create a data migration script. In the past I used a <a href=http://www.actualtech.com>commercial ODBC driver</a>. But ODBC on OS X was deprecated ages ago.</p><p>In this post, I&rsquo;ll talk about my current stack for accessing SQL Server databases via Ruby and Python and how to set it up. <span class=light>Note that I do not use <a href=http://mxcl.github.io/homebrew/>homebrew</a>, so these are all native installs.</span></p><p>You will need Xcode and the command line tools installed, <em>which of course you already have</em>.</p><h2 id=freetds>FreeTDS</h2><p><a href=http://www.freetds.org>FreeTDS</a> is a set of libraries that one can use from UNIX based systems to natively talk to SQL Server. Download it from their <a href=ftp://ftp.freetds.org/pub/freetds/stable/freetds-stable.tgz>stable release</a> link to your <code>Downloads</code> folder (current version 0.91 as of writing).</p><p>Then, to build and install it:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ tar zxvf freetds-stable.tar
</span></span><span style=display:flex><span>$ <span style=color:#a90d91>cd</span> freetds-0.91
</span></span><span style=display:flex><span>$ ./configure --prefix<span style=color:#000>=</span>/usr/local
</span></span><span style=display:flex><span>$ make
</span></span><span style=display:flex><span>$ sudo make install
</span></span></code></pre></div><p>To have FreeTDS default to the newer protocols for newer SQL servers, edit <code>/usr/local/etc/freetds.conf</code> and set:</p><pre tabindex=0><code>[global]
# TDS protocol version
tds version = 7.1 # or 8.0
</code></pre><p>This works with SQL Server 2000, 2005 and 2008.</p><h2 id=ruby>Ruby</h2><p>You need the <a href=https://github.com/rails-sqlserver/tiny_tds>tiny_tds</a> Ruby gem to access SQL Server via FreeTDS from Ruby. I had a lot of trouble getting this gem to build on OS X 10.8.4 with Ruby 1.9.3 under RVM until I figured out the parameters needed to make it work with my FreeTDS and Apple&rsquo;s <code>iconv</code> library. Use the following <em>rather long</em> command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ gem install tiny_tds -- --with-iconv-include<span style=color:#000>=</span>/usr/include --with-iconv-lib<span style=color:#000>=</span>/usr/lib <span style=color:#c41a16>\
</span></span></span><span style=display:flex><span><span style=color:#c41a16></span>--with-freetds-include<span style=color:#000>=</span>/usr/local/include/freetds --with-freetds-lib<span style=color:#000>=</span>/usr/local/lib
</span></span></code></pre></div><p>This compiles the gem with Apple&rsquo;s <code>iconv</code> lib and the FreeTDS we just installed.</p><p>After that, accessing a SQL Server database is easy. Here&rsquo;s a script to dump a table or a query to a CSV file:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#a90d91>require</span> <span style=color:#c41a16>&#39;rubygems&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>require</span> <span style=color:#c41a16>&#39;tiny_tds&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>require</span> <span style=color:#c41a16>&#39;csv&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>write_csv</span>(<span style=color:#000>table</span>, <span style=color:#000>result</span>)
</span></span><span style=display:flex><span>  <span style=color:#000>CSV</span><span style=color:#000>.</span><span style=color:#000>open</span>(<span style=color:#c41a16>&#34;</span><span style=color:#c41a16>#{</span><span style=color:#000>table</span><span style=color:#c41a16>}</span><span style=color:#c41a16>.csv&#34;</span>, <span style=color:#c41a16>&#34;wb&#34;</span>) <span style=color:#a90d91>do</span> <span style=color:#000>|</span><span style=color:#000>csv</span><span style=color:#000>|</span>
</span></span><span style=display:flex><span>    <span style=color:#000>result</span><span style=color:#000>.</span><span style=color:#000>each</span> <span style=color:#a90d91>do</span> <span style=color:#000>|</span><span style=color:#000>row</span><span style=color:#000>|</span>
</span></span><span style=display:flex><span>      <span style=color:#000>csv</span> <span style=color:#000>&lt;&lt;</span> <span style=color:#000>row</span><span style=color:#000>.</span><span style=color:#000>values</span>
</span></span><span style=display:flex><span>    <span style=color:#a90d91>end</span>
</span></span><span style=display:flex><span>  <span style=color:#a90d91>end</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>dump_table</span>(<span style=color:#000>table</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>puts</span> <span style=color:#c41a16>&#34;dump_table: </span><span style=color:#c41a16>#{</span><span style=color:#000>table</span><span style=color:#c41a16>}</span><span style=color:#c41a16>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>result</span> <span style=color:#000>=</span> <span style=color:#000>@client</span><span style=color:#000>.</span><span style=color:#000>execute</span>(<span style=color:#c41a16>&#34;SELECT * FROM </span><span style=color:#c41a16>#{</span><span style=color:#000>table</span><span style=color:#c41a16>}</span><span style=color:#c41a16>&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#000>write_csv</span> <span style=color:#000>table</span>, <span style=color:#000>result</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>def</span> <span style=color:#000>dump_query</span>(<span style=color:#000>table</span>, <span style=color:#000>query</span>)
</span></span><span style=display:flex><span>  <span style=color:#a90d91>puts</span> <span style=color:#c41a16>&#34;dump_query: </span><span style=color:#c41a16>#{</span><span style=color:#000>table</span><span style=color:#c41a16>}</span><span style=color:#c41a16>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>result</span> <span style=color:#000>=</span> <span style=color:#000>@client</span><span style=color:#000>.</span><span style=color:#000>execute</span>(<span style=color:#000>query</span>)
</span></span><span style=display:flex><span>  <span style=color:#000>write_csv</span> <span style=color:#000>table</span>, <span style=color:#000>result</span>
</span></span><span style=display:flex><span><span style=color:#a90d91>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@client</span> <span style=color:#000>=</span> <span style=color:#000>TinyTds</span><span style=color:#000>::</span><span style=color:#000>Client</span><span style=color:#000>.</span><span style=color:#000>new</span>(
</span></span><span style=display:flex><span>	<span style=color:#c41a16>:username</span> <span style=color:#000>=&gt;</span> <span style=color:#c41a16>&#39;username&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#c41a16>:password</span> <span style=color:#000>=&gt;</span> <span style=color:#c41a16>&#39;password&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#c41a16>:host</span> <span style=color:#000>=&gt;</span> <span style=color:#c41a16>&#39;192.168.x.x&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#c41a16>:database</span> <span style=color:#000>=&gt;</span> <span style=color:#c41a16>&#39;database _name&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>dump_table</span>(<span style=color:#c41a16>&#39;table_name&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#000>dump_query</span>(<span style=color:#c41a16>&#39;table_name&#39;</span>, <span style=color:#c41a16>&#34;select * from table_name where date &gt;= &#39;2013-01-01&#39;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>@client</span><span style=color:#000>.</span><span style=color:#000>close</span>()
</span></span></code></pre></div><h2 id=python>Python</h2><p>For Python, I tried the <a href=http://code.google.com/p/pymssql/>pymssql</a> language extension. Installing this was quite easy:</p><pre tabindex=0><code>$ sudo easy_install pip
$ sudo pip install cython
$ sudo pip install pymssql
</code></pre><p>And in a simple script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#000>pymssql</span>
</span></span><span style=display:flex><span><span style=color:#000>connection</span> <span style=color:#000>=</span> <span style=color:#000>pymssql</span><span style=color:#000>.</span><span style=color:#000>connect</span>(
</span></span><span style=display:flex><span>	<span style=color:#000>host</span> <span style=color:#000>=</span> <span style=color:#c41a16>r</span><span style=color:#c41a16>&#39;192.168.x.y:1433&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#000>user</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;username&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#000>password</span> <span style=color:#000>=</span> <span style=color:#c41a16>r</span><span style=color:#c41a16>&#39;password&#39;</span>, 
</span></span><span style=display:flex><span>	<span style=color:#000>database</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;database_name&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>cursor</span> <span style=color:#000>=</span> <span style=color:#000>connection</span><span style=color:#000>.</span><span style=color:#000>cursor</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>cursor</span><span style=color:#000>.</span><span style=color:#000>execute</span>(<span style=color:#c41a16>&#39;SELECT count(*) FROM table_name &#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a90d91>for</span> <span style=color:#000>row</span> <span style=color:#000>in</span> <span style=color:#000>cursor</span>:
</span></span><span style=display:flex><span>    <span style=color:#a90d91>print</span> <span style=color:#000>row</span>
</span></span></code></pre></div><p><strong>Note</strong> the use of Python raw strings for the host and password.</p><h2 id=bonus-round-isql>Bonus Round: <code>isql</code></h2><p>If you are old school like me and want access to SQL Server from the command line, you really need the old <code>isql</code> command line. FreeTDS does have a <code>tsql</code> command to test access from the command line, but it is not fully featured.</p><p>But <code>isql</code> is part of ODBC which is deprecated. Oh, well, time to install <a href=http://www.unixodbc.org>unixODBC</a>. It&rsquo;s an oldie, but a goodie. Download from this <a href=ftp://ftp.unixodbc.org/pub/unixODBC/unixODBC-2.3.1.tar.gz>link</a> or the downloads page. Then:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./configure --prefix<span style=color:#000>=</span>/usr/local
</span></span><span style=display:flex><span>$ make
</span></span><span style=display:flex><span>$ sudo make install
</span></span></code></pre></div><p>You also need to recompile FreeTDS with support for <code>unixODBC</code>, so go back to your FreeTDS folder and:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ <span style=color:#a90d91>cd</span> freetds-0.91
</span></span><span style=display:flex><span>$ ./configure --prefix<span style=color:#000>=</span>/usr/local --with-tdsver<span style=color:#000>=</span>8.0 --with-unixodbc<span style=color:#000>=</span>/usr/local
</span></span><span style=display:flex><span>$ make
</span></span><span style=display:flex><span>$ sudo make install
</span></span></code></pre></div><p>Following the instructions at <a href=http://www.unixodbc.org/doc/FreeTDS.html>http://www.unixodbc.org/doc/FreeTDS.html</a>, you need to register FreeTDS and create your first data source. My files look like this:</p><pre tabindex=0><code>[FreeTDS]
Description=v0.63 with protocol v8.0
Driver=/usr/local/lib/libtdsodbc.so
UsageCount=1
</code></pre><p>and</p><pre tabindex=0><code>[TEST]
Driver=FreeTDS
Description=Test Database
Trace=No
Address=192.168.x.y
Port=1433
Database=database_name
TDS_Version=7.1
</code></pre><p>To see if this is working, use the <code>osql</code> tool:</p><pre tabindex=0><code>$ osql -S TEST -U user_name -P password -I /usr/local/etc
</code></pre><p>You can then access this database using good old <code>isql</code>:</p><pre tabindex=0><code>$ isql TEST user_name password
</code></pre><p><strong>Note</strong> that you may need to put <code>"</code> characters around the password if there are special characters in it.</p><h2 id=commentary>Commentary</h2><p>It&rsquo;s quite sad that the popular Open Source databases like MySQL, PostgreSQL and MongoDB all have wonderful, fast, easy to install, native libraries for OS X and Linux, but the big commercial databases like SQL Server and Oracle still require these unpleasant hacks, ancient deprecated libraries or worse, Java!</p><p>A lot of companies are moving their servers off Microsoft Windows and on to Linux, but they still need access to legacy data, and these hacks are just not that elegant or robust enough for true production use. Until these companies can migrate their databases off Microsoft and Oracle, they are going to have to live in transition and hope these hacks hold.</p><p>I think it&rsquo;s in Microsoft and Oracle&rsquo;s interest to release public libraries to access their databases from anywhere, including other platforms, in order to stay relevant and in the game.</p><p><em>Follow the author as <a href=https://twitter.com/hiltmon>@hiltmon</a> on Twitter and <a href=http://alpha.app.net/hiltmon>@hiltmon</a> on App.Net. Mute <code>#xpost</code> on one.</em></p></div><p class=post-mark><span class="fas fa-envelope"></span>
<span>Posted By Hilton Lipschitz</span>
&#183;
<span class="fas fa-clock"></span>
<span>Jun 9, 2013 10:56 AM</span></p><div class=pagination><ul><li class=post-previous><a href=https://hiltmon.com/blog/2013/06/15/wwdc-2013-post-game-review/>&larr; WWDC 2013 Post-Game Review</a></li><li class=post-center>&nbsp;</li><li class=post-next><a href=https://hiltmon.com/blog/2013/06/06/horizons/>Horizons &rarr;</a></li></ul></div></section><aside id=sidebar><script async type=text/javascript src="//cdn.carbonads.com/carbon.js?serve=CKYI52JE&placement=hiltmoncom" id=_carbonads_js></script><section><div id=carbonads></div>&nbsp;</section><section><h1>The Hiltmon Dot Com</h1><p><strong>Hilton Lipschitz</strong> (<a href=https://twitter.com/hiltmon>@hiltmon</a>) is CTO of an up and coming Hedge Fund, who loves to craft brilliant and delightful web, iPhone, iPad and Macintosh software products. Before this he was an independent software consultant, designer and developer at <a href=https://noverse.com>Noverse LLC</a>.</p></section><section><h1>Recent Posts</h1><ul><li><a class=sidebar-link href=https://hiltmon.com/blog/2022/08/10/code-review-is-not-all-about-the-code/>Code Review is not all about the Code</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/06/07/working-from-home-88-days-later/>Working from Home ... 88 Days Later</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2020/03/14/working-from-home-dot-dot-dot-here-we-go/>Working from Home ... here we go!</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/12/31/the-theater-was-empty/>The Theater was Empty</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/16/an-ipad-and-a-pencil/>An iPad and a Pencil</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2019/02/09/testing-c-plus-plus-17-project-in-xcode-with-xctest/>Testing C++17 Projects in Xcode with XCTest</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/on-removing-comments/>On Removing Comments</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2018/06/17/stop-and-think/>Stop and Think</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/08/31/migrate-octopress-slash-jekyll-posts-to-ulysses/>Migrate Octopress / Jekyll Posts to Ulysses</a></li><li><a class=sidebar-link href=https://hiltmon.com/blog/2017/03/12/notification-city/>Notification City</a></li></ul><section></aside><footer id=footer><p>Copyright &copy; 2022 Hilton Lipschitz</p></footer></div></body></html>